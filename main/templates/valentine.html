{% extends "base.html" %}

{% block title %}Walentynki ‚Äî Czy zostaniesz mojƒÖ walentynkƒÖ?{% endblock %}

{% block extra_head %}
<style>
  /* =========================
     Mobil-first, t…ôk fayl dizayn
     ========================= */
  :root{
    --bg1:#050816;
    --bg2:#0b1228;
    --card: rgba(255,255,255,.06);
    --card2: rgba(255,255,255,.09);
    --text:#eaf0ff;
    --muted: rgba(234,240,255,.72);
    --primary:#7c3aed;
    --primary2:#22c55e;
    --danger:#ef4444;
    --warning:#f59e0b;
    --stroke: rgba(255,255,255,.14);
    --shadow: 0 24px 70px rgba(0,0,0,.45);
    --radius: 22px;
  }

  .valentynki-wrap{
    position: relative;
    min-height: calc(100vh - 0px);
    padding: 22px 0 40px;
    overflow: hidden;
    background:
      radial-gradient(1200px 800px at 20% 10%, rgba(124,58,237,.22), transparent 55%),
      radial-gradient(1000px 700px at 90% 20%, rgba(34,197,94,.14), transparent 55%),
      radial-gradient(900px 600px at 40% 90%, rgba(239,68,68,.12), transparent 55%),
      linear-gradient(180deg, var(--bg1), var(--bg2));
  }

  /* parlayan ‚Äúblob‚Äùlar */
  .blob{
    position:absolute;
    filter: blur(38px);
    opacity:.65;
    border-radius:999px;
    animation: blob 10s ease-in-out infinite;
    pointer-events:none;
    mix-blend-mode: screen;
  }
  .blob.b1{ width:280px;height:280px; left:-60px; top:70px; background: rgba(124,58,237,.55); }
  .blob.b2{ width:240px;height:240px; right:-80px; top:120px; background: rgba(34,197,94,.40); animation-delay: -3s;}
  .blob.b3{ width:220px;height:220px; left:30%; bottom:-90px; background: rgba(239,68,68,.30); animation-delay: -6s;}
  @keyframes blob{
    0%,100%{ transform: translate(0,0) scale(1); }
    50%{ transform: translate(18px,-16px) scale(1.08); }
  }

  /* …ôsas card */
  .val-card{
    position: relative;
    max-width: 980px;
    margin: 0 auto;
    padding: 16px;
  }

  .glass{
    border-radius: var(--radius);
    background: linear-gradient(135deg, rgba(255,255,255,.08), rgba(255,255,255,.04));
    border: 1px solid var(--stroke);
    box-shadow: var(--shadow);
    overflow: hidden;
  }

  .hero{
    display:grid;
    grid-template-columns: 1fr;
    gap: 14px;
    padding: 18px;
  }

  .badge{
    display:inline-flex;
    align-items:center;
    gap:10px;
    padding: 10px 12px;
    border-radius: 999px;
    border: 1px solid var(--stroke);
    background: rgba(255,255,255,.06);
    width: fit-content;
  }
  .badge .dot{
    width:10px;height:10px;border-radius:999px;
    background: linear-gradient(135deg, var(--primary), #60a5fa);
    box-shadow: 0 0 0 6px rgba(124,58,237,.12);
    animation: pulse 1.4s ease-in-out infinite;
  }
  @keyframes pulse{
    0%,100%{ transform: scale(1); opacity: 1;}
    50%{ transform: scale(1.25); opacity: .7;}
  }

  .basliq{
    margin: 6px 0 0;
    color: var(--text);
    font-weight: 900;
    letter-spacing: -0.02em;
    line-height: 1.05;
    font-size: clamp(28px, 6vw, 54px);
  }

  .alt{
    margin: 8px 0 0;
    color: var(--muted);
    font-size: clamp(14px, 3.3vw, 18px);
    line-height: 1.5;
    max-width: 62ch;
  }

  .arena{
    position: relative;
    margin-top: 14px;
    border-radius: calc(var(--radius) - 6px);
    border: 1px solid var(--stroke);
    background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
    overflow:hidden;
    min-height: 420px;
  }

  /* ‚Äús…ôhn…ô‚Äù i√ßind…ô ayƒ± dola≈üacaq */
  .sahne{
    position:relative;
    height: 420px;
    overflow: hidden;
  }

  /* yuxarƒ±da status mesajƒ± */
  .status{
    position:absolute;
    left: 14px;
    right: 14px;
    top: 14px;
    z-index: 5;
    display:flex;
    gap: 10px;
    align-items:center;
    justify-content: space-between;
  }
  .status-box{
    flex: 1;
    padding: 10px 12px;
    border-radius: 14px;
    border: 1px solid var(--stroke);
    background: rgba(0,0,0,.18);
    backdrop-filter: blur(8px);
    color: var(--muted);
    font-size: 13px;
    display:flex;
    align-items:center;
    gap: 10px;
  }
  .status-emoji{
    width: 34px; height: 34px;
    border-radius: 12px;
    display:grid;
    place-items:center;
    background: rgba(255,255,255,.08);
    border: 1px solid var(--stroke);
  }

  /* d√ºym…ôl…ôr */
  .duymeler{
    position:absolute;
    left: 14px;
    right: 14px;
    bottom: 14px;
    z-index: 6;
    display:flex;
    gap: 12px;
    align-items: center;
    justify-content: center;
    flex-wrap: wrap;
    padding: 12px;
    border-radius: 16px;
    border: 1px solid var(--stroke);
    background: rgba(0,0,0,.18);
    backdrop-filter: blur(10px);
  }

  .btn-val{
    appearance:none;
    border: 1px solid var(--stroke);
    border-radius: 16px;
    padding: 13px 16px;
    min-width: 140px;
    font-weight: 800;
    letter-spacing: .2px;
    color: var(--text);
    background: rgba(255,255,255,.08);
    box-shadow: 0 10px 28px rgba(0,0,0,.22);
    transform: translateZ(0);
    transition: transform .16s ease, background .16s ease, box-shadow .16s ease, border-color .16s ease;
    user-select:none;
    touch-action: manipulation;
  }
  .btn-val:hover{ transform: translateY(-2px); background: rgba(255,255,255,.11); }
  .btn-val:active{ transform: translateY(1px) scale(.99); }

  .btn-yes{
    border-color: rgba(34,197,94,.35);
    background: linear-gradient(135deg, rgba(34,197,94,.22), rgba(124,58,237,.18));
  }
  .btn-no{
    border-color: rgba(239,68,68,.35);
    background: linear-gradient(135deg, rgba(239,68,68,.18), rgba(245,158,11,.12));
  }
  .btn-val[disabled]{
    opacity:.55;
    cursor:not-allowed;
    transform:none !important;
  }

  /* ayƒ± container */
  .ayi-qutu{
    position:absolute;
    left: 50%;
    top: 52%;
    transform: translate(-50%, -50%);
    width: min(240px, 70vw);
    height: auto;
    z-index: 4;
    transition: transform .3s ease;
    will-change: transform;
  }

  /* ayƒ±nƒ±n ‚Äúyer k√∂lg…ôsi‚Äù */
  .k√∂lge{
    position:absolute;
    left: 50%;
    top: 68%;
    transform: translateX(-50%);
    width: 62%;
    height: 18px;
    border-radius: 999px;
    background: rgba(0,0,0,.35);
    filter: blur(8px);
    opacity:.55;
    z-index: 2;
  }

  /* canvas (konfetti/at…ô≈üf…ô≈üanlƒ±q) */
  #konfettiCanvas{
    position:absolute;
    inset:0;
    z-index: 3;
    pointer-events:none;
    opacity: 0;
    transition: opacity .35s ease;
  }
  .konfetti-aktif #konfettiCanvas{
    opacity: 1;
  }

  /* n…ôtic…ô paneli */
  .netice{
    display:none;
    margin-top: 14px;
    padding: 16px 16px;
    border-radius: var(--radius);
    border: 1px solid rgba(34,197,94,.35);
    background: linear-gradient(135deg, rgba(34,197,94,.12), rgba(124,58,237,.10));
    color: var(--text);
  }
  .netice h2{
    margin:0;
    font-size: 18px;
    font-weight: 900;
    letter-spacing: -0.01em;
  }
  .netice p{
    margin: 8px 0 0;
    color: var(--muted);
    line-height: 1.5;
  }

  /* responsive grid (tablet/pc) */
  @media (min-width: 860px){
    .hero{
      grid-template-columns: 1.1fr .9fr;
      align-items: center;
      padding: 26px;
      gap: 18px;
    }
    .arena{ min-height: 520px; }
    .sahne{ height: 520px; }
    .ayi-qutu{ width: 260px; }
  }

  /* =========================
     SVG animasyon sinifl…ôri
     ========================= */
  .ayi-anim .goz{ transform-origin: center; animation: goz 5.8s ease-in-out infinite; }
  @keyframes goz{
    0%,96%,100%{ transform: scaleY(1); }
    97%{ transform: scaleY(.15); }
  }

  .ayi-anim .breathe{ transform-origin: center; animation: nefes 2.6s ease-in-out infinite; }
  @keyframes nefes{
    0%,100%{ transform: translateY(0) scale(1); }
    50%{ transform: translateY(1px) scale(1.015); }
  }

  /* ‚Äúg√∂st…ôrm…ô‚Äù (barmaq/…ôl) */
  .ayi-goster .el-sag{
    transform-origin: 170px 160px;
    animation: goster 1s ease-in-out infinite;
  }
  @keyframes goster{
    0%,100%{ transform: rotate(0deg) translateY(0); }
    50%{ transform: rotate(-10deg) translateY(-2px); }
  }

  /* …ôs…ôbi titr…ôm…ô */
  .ayi-esebi{
    animation: sarsil .14s ease-in-out infinite;
    filter: drop-shadow(0 18px 30px rgba(239,68,68,.12));
  }
  @keyframes sarsil{
    0%{ transform: translate(-50%, -50%) translateX(-1px); }
    50%{ transform: translate(-50%, -50%) translateX(1px); }
    100%{ transform: translate(-50%, -50%) translateX(-1px); }
  }

  /* sevinc r…ôqsi */
  .ayi-sevin{
    animation: sevin 1.1s ease-in-out infinite;
    filter: drop-shadow(0 18px 30px rgba(34,197,94,.14));
  }
  @keyframes sevin{
    0%,100%{ transform: translate(-50%, -50%) rotate(-2deg) scale(1.02); }
    50%{ transform: translate(-50%, -52%) rotate(3deg) scale(1.05); }
  }

  /* No d√ºym…ôsinin qa√ßmasƒ± √º√ß√ºn */
  .qacan{
    position:absolute !important;
    left: 50%;
    top: 50%;
    transform: translate(-50%, -50%);
    z-index: 7;
  }

  /* ki√ßik k√∂m…ôk m…ôtni */
  .kicik{
    margin-top: 8px;
    color: rgba(234,240,255,.55);
    font-size: 12px;
  }
</style>
{% endblock %}

{% block content %}
<div class="valentynki-wrap">
  <div class="blob b1"></div>
  <div class="blob b2"></div>
  <div class="blob b3"></div>

  <div class="container">
    <div class="val-card">
      <div class="glass">
        <div class="hero">
          <div>
            <div class="badge">
              <span class="dot"></span>
              <span style="color: rgba(234,240,255,.82); font-weight: 700; font-size: 13px;">
                Tryb: Walentynkowy (misiek w akcji)
              </span>
            </div>

            <h1 class="basliq">Czy zostaniesz mojƒÖ walentynkƒÖ?</h1>
            <p class="alt">
              Ma≈Çy mi≈õ czeka na odpowied≈∫‚Ä¶ i mo≈ºe siƒô trochƒô zdenerwowaƒá, je≈õli bƒôdziesz klikaƒá ‚ÄûNie‚Äù.
            </p>
            <div class="kicik">Tip: ‚ÄûNie‚Äù jest bardzo niegrzeczne dzisiaj üòÑ</div>
          </div>

          <div class="arena">
            <canvas id="konfettiCanvas"></canvas>

            <div class="sahne" id="sahne">
              <div class="status">
                <div class="status-box" id="statusBox">
                  <div class="status-emoji" id="statusEmoji">üêª</div>
                  <div>
                    <div style="font-weight:800; color: rgba(234,240,255,.9); font-size: 13px;">
                      Status misia
                    </div>
                    <div id="statusMetn">
                      Spaceruje i czeka na odpowied≈∫‚Ä¶
                    </div>
                  </div>
                </div>
              </div>

              <div class="k√∂lge"></div>

              <!-- Ayƒ± (SVG) -->
              <div class="ayi-qutu ayi-anim ayi-goster" id="ayiQutu" aria-hidden="true">
                <svg viewBox="0 0 240 240" width="100%" height="100%">
                  <!-- qulaq -->
                  <circle cx="62" cy="66" r="26" fill="rgba(255,255,255,.08)" stroke="rgba(255,255,255,.12)"/>
                  <circle cx="178" cy="66" r="26" fill="rgba(255,255,255,.08)" stroke="rgba(255,255,255,.12)"/>
                  <circle cx="62" cy="66" r="14" fill="rgba(255,255,255,.06)"/>
                  <circle cx="178" cy="66" r="14" fill="rgba(255,255,255,.06)"/>

                  <!-- b…ôd…ôn -->
                  <g class="breathe">
                    <path d="M120 56
                             C170 56 200 92 200 136
                             C200 185 165 206 120 206
                             C75 206 40 185 40 136
                             C40 92 70 56 120 56Z"
                          fill="rgba(255,255,255,.08)"
                          stroke="rgba(255,255,255,.14)"
                          stroke-width="2" />

                    <!-- qarƒ±n -->
                    <path d="M120 98
                             C152 98 172 122 172 150
                             C172 178 150 190 120 190
                             C90 190 68 178 68 150
                             C68 122 88 98 120 98Z"
                          fill="rgba(255,255,255,.06)"
                          stroke="rgba(255,255,255,.10)"/>

                    <!-- √ºz -->
                    <circle cx="120" cy="115" r="48" fill="rgba(255,255,255,.07)" stroke="rgba(255,255,255,.12)"/>

                    <!-- g√∂zl…ôr -->
                    <g class="goz">
                      <ellipse cx="102" cy="112" rx="6" ry="8" fill="rgba(234,240,255,.92)"/>
                      <ellipse cx="138" cy="112" rx="6" ry="8" fill="rgba(234,240,255,.92)"/>
                      <circle cx="102" cy="114" r="2.5" fill="rgba(0,0,0,.55)"/>
                      <circle cx="138" cy="114" r="2.5" fill="rgba(0,0,0,.55)"/>
                    </g>

                    <!-- yanaqlar -->
                    <circle cx="92" cy="130" r="8" fill="rgba(239,68,68,.22)"/>
                    <circle cx="148" cy="130" r="8" fill="rgba(239,68,68,.22)"/>

                    <!-- burun+aƒüƒ±z -->
                    <path d="M120 124
                             C128 124 134 130 134 138
                             C134 147 127 152 120 152
                             C113 152 106 147 106 138
                             C106 130 112 124 120 124Z"
                          fill="rgba(0,0,0,.32)"/>
                    <path d="M120 152
                             C114 156 110 160 108 165
                             M120 152
                             C126 156 130 160 132 165"
                          stroke="rgba(234,240,255,.75)"
                          stroke-width="3"
                          stroke-linecap="round"/>

                    <!-- sol …ôl -->
                    <path d="M52 150
                             C36 150 30 134 40 124
                             C52 112 64 122 68 134
                             C72 146 64 150 52 150Z"
                          fill="rgba(255,255,255,.08)" stroke="rgba(255,255,255,.12)"/>

                    <!-- saƒü …ôl (g√∂st…ôr…ôn) -->
                    <g class="el-sag">
                      <path d="M188 150
                               C204 150 210 134 200 124
                               C188 112 176 122 172 134
                               C168 146 176 150 188 150Z"
                            fill="rgba(255,255,255,.08)" stroke="rgba(255,255,255,.12)"/>
                      <!-- ki√ßik ox i≈üar…ôsi -->
                      <path d="M195 128 L220 128 L212 121 M220 128 L212 135"
                            stroke="rgba(234,240,255,.72)" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
                    </g>

                    <!-- ayaqlar -->
                    <path d="M92 200 C72 208 68 226 90 228 C108 230 112 214 92 200Z"
                          fill="rgba(255,255,255,.08)" stroke="rgba(255,255,255,.12)"/>
                    <path d="M148 200 C168 208 172 226 150 228 C132 230 128 214 148 200Z"
                          fill="rgba(255,255,255,.08)" stroke="rgba(255,255,255,.12)"/>
                  </g>
                </svg>
              </div>

              <div class="duymeler" id="duymeler">
                <button class="btn-val btn-yes" id="btnYes" type="button">Tak ‚ù§Ô∏è</button>
                <button class="btn-val btn-no" id="btnNo" type="button">Nie üòÖ</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- n…ôtic…ô -->
      <div class="netice" id="netice">
        <h2>Awwwww‚Ä¶ üíú</h2>
        <p id="neticeMetn">
          Jeste≈õ oficjalnie walentynkƒÖ Elvina ‚Äî kochana Ola hehe üòÑ
        </p>
      </div>
    </div>
  </div>
</div>

<script>
/*
  Az…ôrbaycan dilind…ô kod/≈ü…ôrhl…ôr.
  M…ôtnl…ôr (UI) polyak√ßa.
*/

(function(){
  // ==== elementl…ôr ====
  const sahne = document.getElementById("sahne");
  const duymeler = document.getElementById("duymeler");
  const btnYes = document.getElementById("btnYes");
  const btnNo  = document.getElementById("btnNo");
  const statusMetn = document.getElementById("statusMetn");
  const statusEmoji = document.getElementById("statusEmoji");
  const ayiQutu = document.getElementById("ayiQutu");
  const netice = document.getElementById("netice");

  const canvas = document.getElementById("konfettiCanvas");
  const ctx = canvas.getContext("2d", { alpha: true });

  // ==== v…ôziyy…ôt ====
  let noSay = 0;
  let qa√ßmaAktiv = false;
  let noBloklandi = false;
  let valentineBitdi = false;

  // ayƒ±nƒ±n dola≈ümasƒ± √º√ß√ºn
  let hedefX = 0;
  let hedefY = 0;
  let cariX = 0;
  let cariY = 0;

  // mobil/desktop √∂l√ß√º yenil…ônm…ôsi
  function canvasOlcu(){
    const r = sahne.getBoundingClientRect();
    canvas.width = Math.floor(r.width * devicePixelRatio);
    canvas.height = Math.floor(r.height * devicePixelRatio);
    canvas.style.width = r.width + "px";
    canvas.style.height = r.height + "px";
    ctx.setTransform(devicePixelRatio, 0, 0, devicePixelRatio, 0, 0);
  }
  window.addEventListener("resize", canvasOlcu, { passive:true });
  canvasOlcu();

  // ==== random k√∂m…ôk√ßi ====
  const rnd = (a,b)=> a + Math.random()*(b-a);

  // ==== ayƒ± g…ôzsin (smooth follow) ====
  function yeniHedefSec(){
    const r = sahne.getBoundingClientRect();
    // d√ºym…ôl…ôr zolaƒüƒ±nƒ± √ßox basmasƒ±n dey…ô yuxarƒ± hiss…ôd…ô h…ôd…ôf se√ß…ôk
    hedefX = rnd(40, r.width - 40);
    hedefY = rnd(120, r.height - 160);
  }
  yeniHedefSec();

  function ayiGuncelle(){
    if(valentineBitdi) return;

    // yava≈ü-yava≈ü h…ôd…ôf…ô yaxƒ±nla≈üsƒ±n
    cariX += (hedefX - cariX) * 0.02;
    cariY += (hedefY - cariY) * 0.02;

    // h…ôd…ôf…ô √ßatanda yenisini se√ß
    const dx = hedefX - cariX;
    const dy = hedefY - cariY;
    if(Math.hypot(dx,dy) < 10){
      yeniHedefSec();
    }

    // ayƒ± qutusunu s…ôhn…ôd…ô h…ôr…ôk…ôt etdir
    ayiQutu.style.left = cariX + "px";
    ayiQutu.style.top  = cariY + "px";
    ayiQutu.style.transform = "translate(-50%, -50%)";

    requestAnimationFrame(ayiGuncelle);
  }
  // start
  const r0 = sahne.getBoundingClientRect();
  cariX = r0.width/2;
  cariY = r0.height/2;
  requestAnimationFrame(ayiGuncelle);

  // ==== status d…ôyi≈ü…ôn mesajlar ====
  function statusYaz(emoji, metn){
    statusEmoji.textContent = emoji;
    statusMetn.textContent = metn;
  }

  // ==== No d√ºym…ôsinin ‚Äú≈üuluqlu‚Äù ideyalarƒ± ====
  const noMesajlar = [
    "Ej‚Ä¶ serio? üò∂",
    "Misiek siƒô krzywi‚Ä¶",
    "Okej, ale dlaczego ‚ÄûNie‚Äù? ü•∫",
    "Misiek zaczyna siƒô denerwowaƒá‚Ä¶",
    "Jeszcze raz klikniesz ‚ÄûNie‚Äù? üò§",
    "To ju≈º przesada‚Ä¶",
    "Uwaga: Misiek w trybie chaosu üåÄ",
    "Ostatnie ostrze≈ºenie‚Ä¶ üòà"
  ];

  function ayiEs…ôbilesin(guclu=false){
    ayiQutu.classList.add("ayi-esebi");
    ayiQutu.classList.remove("ayi-sevin");
    ayiQutu.classList.remove("ayi-goster");
    statusYaz("üòæ", guclu ? "Misiek jest W≈öCIEK≈ÅY!" : "Misiek siƒô denerwuje‚Ä¶");

    // titr…ôm…ôni qƒ±sa saxla
    setTimeout(()=> {
      if(!valentineBitdi){
        ayiQutu.classList.remove("ayi-esebi");
        ayiQutu.classList.add("ayi-goster");
        statusYaz("üêª", "Spaceruje i czeka na odpowied≈∫‚Ä¶");
      }
    }, guclu ? 900 : 650);
  }

  // No qa√ßdƒ±rma (random pozisiya)
  function noQacsin(){
    if(noBloklandi || valentineBitdi) return;

    const r = sahne.getBoundingClientRect();
    const btnR = btnNo.getBoundingClientRect();

    // sahn…ô i√ßind…ô t…ôsad√ºfi yer
    const maxX = r.width - btnR.width - 20;
    const maxY = r.height - btnR.height - 120; // alt d√ºym…ôl…ôr sah…ôsi il…ô √ßakƒ±≈ümasƒ±n
    const x = rnd(20, Math.max(20, maxX));
    const y = rnd(90, Math.max(90, maxY));

    btnNo.classList.add("qacan");
    btnNo.style.left = x + "px";
    btnNo.style.top  = y + "px";
  }

  // sonda ayƒ± g…ôlib No-nu ‚Äúqorusun‚Äù
  function ayiNoQorusun(){
    noBloklandi = true;

    // No d√ºym…ôsini s…ôhn…ôd…ô sabit bir yer…ô qoyaq
    btnNo.classList.add("qacan");
    btnNo.style.left = "50%";
    btnNo.style.top  = "56%";
    btnNo.style.transform = "translate(-50%, -50%)";
    btnNo.disabled = true;

    // ayƒ±nƒ± da No qar≈üƒ±sƒ±na g…ôtir…ôk
    const r = sahne.getBoundingClientRect();
    hedefX = r.width/2;
    hedefY = r.height*0.44;

    ayiQutu.classList.remove("ayi-goster");
    statusYaz("üß∏", "Misiek usiad≈Ç przed ‚ÄûNie‚Äù. Teraz masz tylko jednƒÖ opcjƒô üòå");
  }

  // ==== No hadis…ôl…ôri ====
  btnNo.addEventListener("click", () => {
    if(valentineBitdi) return;

    noSay++;

    // ayƒ± …ôs…ôbil…ô≈üsin (getdikc…ô daha g√ºcl√º)
    ayiEs…ôbilesin(noSay >= 5);

    // status m…ôtnini artƒ±r
    const idx = Math.min(noSay-1, noMesajlar.length-1);
    statusYaz("üò§", noMesajlar[idx]);

    // ‚ÄúNo‚Äù d√ºym…ôsinin davranƒ±≈ü m…ôrh…ôl…ôl…ôri
    if(noSay === 2){
      // ‚ÄúNo‚Äù b√∂y√ºy√ºb-ki√ßilsin (≈üuluq)
      btnNo.animate([
        { transform: "translateY(0) rotate(0deg)" },
        { transform: "translateY(-6px) rotate(-3deg)" },
        { transform: "translateY(2px) rotate(3deg)" },
        { transform: "translateY(0) rotate(0deg)" }
      ], { duration: 520, easing: "ease-in-out" });
    }

    if(noSay === 3){
      // Yes d√ºym…ôsini azca ‚Äúcazib…ôdar‚Äù et (b√∂y√ºt)
      btnYes.animate([
        { transform: "scale(1)" },
        { transform: "scale(1.06)" },
        { transform: "scale(1)" }
      ], { duration: 520, easing:"ease-in-out" });
      statusYaz("üêª", "Misiek pokazuje: kliknij ‚ÄûTak‚Äù üôÇüëâ");
    }

    if(noSay >= 4 && !qa√ßmaAktiv && !noBloklandi){
      qa√ßmaAktiv = true;
      statusYaz("üåÄ", "‚ÄûNie‚Äù zaczyna uciekaƒá‚Ä¶ spr√≥buj z≈Çapaƒá!");
      noQacsin();
    }

    if(noSay >= 6 && !noBloklandi){
      // artƒ±q ‚ÄúNo‚Äù √ßox klikl…ônib ‚Äî ayƒ± g…ôlib otursun
      ayiNoQorusun();
    }
  });

  // qa√ßma aktivdirs…ô, √ºz…ôrin…ô g…ôl…ônd…ô qa√ßsƒ±n
  btnNo.addEventListener("pointerenter", () => {
    if(valentineBitdi) return;
    if(qa√ßmaAktiv && !noBloklandi){
      noQacsin();
      // ayƒ± ‚Äúd…ôli‚Äù reaksiya
      statusYaz("üòµ‚Äçüí´", "Za wolno! ‚ÄûNie‚Äù uciek≈Ço.");
    }
  }, { passive:true });

  // ==== Yes basƒ±landa ====
  btnYes.addEventListener("click", () => {
    if(valentineBitdi) return;
    valentineBitdi = true;

    // d√ºym…ôl…ôri s√∂nd√ºr
    btnYes.disabled = true;
    btnNo.disabled = true;

    // n…ôtic…ô g√∂st…ôr
    netice.style.display = "block";
    netice.scrollIntoView({ behavior:"smooth", block:"start" });

    // ayƒ± sevinsin
    ayiQutu.classList.remove("ayi-esebi");
    ayiQutu.classList.remove("ayi-goster");
    ayiQutu.classList.add("ayi-sevin");

    statusYaz("üéâ", "Yesss! Misiek ta≈Ñczy z rado≈õci!");

    // konfetti/at…ô≈üf…ô≈üanlƒ±q start
    sahne.parentElement.classList.add("konfetti-aktif");
    baslaKonfetti(4200);
  });

  // ==== Konfetti / at…ô≈üf…ô≈üanlƒ±q (lightweight canvas) ====
  let hiss…ôcikl…ôr = [];
  function yaradin(){
    const r = sahne.getBoundingClientRect();
    const say = 120;
    for(let i=0;i<say;i++){
      hiss…ôcikl…ôr.push({
        x: rnd(0, r.width),
        y: rnd(-40, r.height*0.2),
        vx: rnd(-1.2, 1.2),
        vy: rnd(2.0, 5.5),
        w: rnd(4, 10),
        h: rnd(6, 14),
        rot: rnd(0, Math.PI*2),
        vr: rnd(-0.12, 0.12),
        alfa: rnd(0.65, 1),
        // r…ôngi hardcode etm…ôd…ôn, HSL il…ô random
        hue: rnd(0, 360),
        tip: Math.random() < 0.18 ? "dair…ô" : "d√ºz"
      });
    }
  }

  function cek(){
    const r = sahne.getBoundingClientRect();
    ctx.clearRect(0,0,r.width,r.height);

    for(const p of hiss…ôcikl…ôr){
      p.x += p.vx;
      p.y += p.vy;
      p.rot += p.vr;
      p.vy *= 0.997;

      // s…ôrh…ôdl…ôr
      if(p.x < -30) p.x = r.width + 30;
      if(p.x > r.width + 30) p.x = -30;

      // √ßiz
      ctx.save();
      ctx.globalAlpha = p.alfa;
      ctx.translate(p.x, p.y);
      ctx.rotate(p.rot);
      ctx.fillStyle = `hsla(${p.hue}, 90%, 62%, ${p.alfa})`;

      if(p.tip === "dair…ô"){
        ctx.beginPath();
        ctx.arc(0,0, p.w*0.5, 0, Math.PI*2);
        ctx.fill();
      }else{
        ctx.fillRect(-p.w/2, -p.h/2, p.w, p.h);
      }
      ctx.restore();
    }

    // a≈üaƒüƒ± d√º≈ü…ônl…ôri sil
    hiss…ôcikl…ôr = hiss…ôcikl…ôr.filter(p => p.y < r.height + 40);
    if(hiss…ôcikl…ôr.length > 0){
      requestAnimationFrame(cek);
    }
  }

  function baslaKonfetti(ms){
    hiss…ôcikl…ôr = [];
    yaradin();
    cek();

    // bir az ‚Äúfƒ±s-fƒ±s‚Äù …ôlav…ô dalƒüa
    const interval = setInterval(()=> {
      if(hiss…ôcikl…ôr.length < 80){
        yaradin();
      }
    }, 380);

    setTimeout(()=> {
      clearInterval(interval);
    }, ms);

    setTimeout(()=> {
      // biti≈üd…ô yava≈ü s√∂ns√ºn
      sahne.parentElement.classList.remove("konfetti-aktif");
    }, ms + 900);
  }
})();
</script>
{% endblock %}
