{% extends "base.html" %}

{% block title %}Valentine{% endblock %}

{% block extra_head %}
<style>
  html, body { height: 100%; overflow: hidden !important; }

  :root{
    --bg: #ffffff;
    --shadow: 0 18px 60px rgba(0,0,0,.18);
    --shadow2: 0 26px 90px rgba(0,0,0,.26);
  }

  .v-screen{
    position: fixed;
    inset: 0;
    width: 100vw;
    height: 100vh;
    background: var(--bg);
    z-index: 99999;
    overflow: hidden;
    touch-action: manipulation;
    -webkit-tap-highlight-color: transparent;
  }

  .v-center{
    position: absolute;
    inset: 0;
    display: grid;
    place-items: center;
  }

  .v-row{
    position: relative;
    display: flex;
    gap: clamp(12px, 3vw, 22px);
    align-items: center;
    justify-content: center;
    width: 100%;
    padding: 22px;
  }

  /* Liquid button base */
  .btn-liquid{
    position: relative;
    display: inline-grid;
    place-items: center;

    width: min(44vw, 360px);
    height: clamp(72px, 12.5vw, 110px);

    border-radius: 999px;
    border: 0;
    cursor: pointer;
    user-select: none;

    color: #fff;
    font-weight: 900;
    letter-spacing: .2px;

    box-shadow: var(--shadow);
    transform: translateZ(0) scale(var(--scale, 1));
    transition: transform .28s ease, box-shadow .28s ease, opacity 1.1s ease;
    overflow: hidden;
    isolation: isolate;
  }

  .btn-liquid:active{ transform: translateZ(0) scale(calc(var(--scale, 1) * .985)); }
  .btn-liquid:hover{ box-shadow: var(--shadow2); }

  .btn-liquid .inner{
    position: relative;
    z-index: 3;
    font-size: clamp(28px, 8vw, 58px);
    line-height: 1;
    text-shadow: 0 10px 30px rgba(0,0,0,.22);
  }

  .btn-liquid canvas{
    position: absolute;
    inset: -70px; /* daha √ßox ‚Äúspill‚Äù -> daha canlƒ± */
    z-index: 1;
    pointer-events: none;
  }

  /* Scale control */
  #yesBtn{ --scale: var(--yesScale, 1); z-index: 8; }
  #noBtn { --scale: var(--noScale, 1); z-index: 6; }

  .no-abs{
    position: fixed !important;
    left: 50%;
    top: 50%;
    transform: translate(-50%, -50%) scale(var(--noScale, 1));
    z-index: 6;
    margin: 0;
  }

  .fade-out{ opacity: 0; transform: scale(.98); pointer-events: none; }

  /* Fullscreen dark overlay */
  .ov{
    position: fixed;
    inset: 0;
    background: #000;
    opacity: 0;
    pointer-events: none;
    transition: opacity 1.6s ease;
    z-index: 40;
  }
  .ov.show{ opacity: 1; }

  canvas.fx{
    position: fixed;
    inset: 0;
    width: 100vw;
    height: 100vh;
    display: block;
    pointer-events: none;
    opacity: 0;
    transition: opacity 1.0s ease;
    z-index: 45;
  }
  canvas.fx.show{ opacity: 1; }

  .msg{
    position: fixed;
    inset: 0;
    display: grid;
    place-items: center;
    text-align: center;
    padding: 26px;
    opacity: 0;
    transform: translateY(10px) scale(.985);
    transition: opacity 1.1s ease, transform 1.1s ease;
    z-index: 60;
    pointer-events: none;
    color: #fff;
    font-weight: 900;
    letter-spacing: -0.02em;
    line-height: 1.15;
  }
  .msg.show{ opacity: 1; transform: translateY(0) scale(1); }

  .msg .line{
    display: block;
    opacity: 0;
    transform: translateY(14px) rotate(-1deg);
    filter: blur(1px);
    animation: lineIn .9s ease forwards;
  }
  .msg .line.l2{ animation-delay: .18s; transform: translateY(16px) rotate(1deg); }
  .msg .line.l3{ animation-delay: .36s; transform: translateY(18px) rotate(-1deg); }

  .msg .line strong{
    background: linear-gradient(90deg, #7c3aed, #22c55e, #ff2d55);
    -webkit-background-clip: text;
    background-clip: text;
    color: transparent;
  }

  @keyframes lineIn{
    to{ opacity: 1; transform: translateY(0) rotate(0deg); filter: blur(0); }
  }

  .msg .t1{ font-size: clamp(20px, 5.4vw, 44px); }
  .msg .t2{ font-size: clamp(16px, 4.2vw, 34px); }
  .msg .t3{ font-size: clamp(14px, 3.8vw, 30px); opacity: .95; }

  .heartScene{
    position: fixed;
    inset: 0;
    background: #000;
    opacity: 0;
    transition: opacity 1.1s ease;
    z-index: 80;
    pointer-events: none;
  }
  .heartScene.show{ opacity: 1; }

  #heartCanvas{
    width: 100vw;
    height: 100vh;
    display: block;
  }

  /* Stage 9: black + only huge YES */
  .stage9{
    background: #000 !important;
  }
  .stage9 #noBtn{ display: none !important; }
  .stage9 #yesBtn{
    position: fixed !important;
    left: 50% !important;
    top: 50% !important;
    transform: translate(-50%, -50%) scale(var(--yesScale, 1)) !important;
    width: min(86vw, 820px) !important;
    height: clamp(88px, 15vw, 140px) !important;
    z-index: 120 !important;
    box-shadow: 0 30px 120px rgba(0,0,0,.75);
  }

  .shake3s{ animation: shake .12s ease-in-out infinite; }
  @keyframes shake{
    0%  { transform: translate(-50%,-50%) scale(var(--noScale, 1)) translateX(-2px); }
    50% { transform: translate(-50%,-50%) scale(var(--noScale, 1)) translateX( 2px); }
    100%{ transform: translate(-50%,-50%) scale(var(--noScale, 1)) translateX(-2px); }
  }

  .break5s{ animation: splitJoin 5s ease-in-out forwards; }
  @keyframes splitJoin{
    0%   { clip-path: inset(0 0 0 0); }
    18%  { clip-path: inset(0 50% 0 0); transform: translate(-50%,-50%) scale(var(--noScale, 1)) translateX(-16px) rotate(-2deg); }
    36%  { clip-path: inset(0 0 0 50%); transform: translate(-50%,-50%) scale(var(--noScale, 1)) translateX( 16px) rotate( 2deg); }
    62%  { clip-path: inset(0 0 0 0); transform: translate(-50%,-50%) scale(var(--noScale, 1)) translateX(0) rotate(0deg); }
    100% { clip-path: inset(0 0 0 0); transform: translate(-50%,-50%) scale(var(--noScale, 1)); }
  }

  @media (max-width: 420px){
    .btn-liquid{ width: min(45vw, 240px); }
  }
</style>
{% endblock %}

{% block content %}
<div class="v-screen" id="root">
  <div class="v-center">
    <div class="v-row" id="row">
      <button class="btn-liquid" id="yesBtn" type="button">
        <span class="inner">Tak</span>
      </button>

      <button class="btn-liquid" id="noBtn" type="button">
        <span class="inner">Nie</span>
      </button>
    </div>
  </div>

  <div class="ov" id="dark"></div>

  <canvas class="fx" id="stars"></canvas>
  <canvas class="fx" id="broken"></canvas>

  <div class="msg" id="msg"></div>

  <div class="heartScene" id="heartScene">
    <canvas id="heartCanvas"></canvas>
  </div>
</div>

<script>
(function(){
  const root = document.getElementById("root");
  const row  = document.getElementById("row");
  const yesBtn = document.getElementById("yesBtn");
  const noBtn  = document.getElementById("noBtn");

  const dark = document.getElementById("dark");
  const stars = document.getElementById("stars");
  const broken = document.getElementById("broken");
  const msg = document.getElementById("msg");

  const heartScene = document.getElementById("heartScene");
  const heartCanvas = document.getElementById("heartCanvas");

  const sctx = stars.getContext("2d");
  const bctx = broken.getContext("2d");
  const hctx = heartCanvas.getContext("2d");

  const MESAJ_HTML = `
    <span class="line t1"><strong>Gratulacje!</strong></span>
    <span class="line l2 t2">Od teraz jeste≈õcie walentynkami‚Ä¶</span>
    <span class="line l3 t3"><strong>Elvin</strong> & <strong>Ola</strong> üíú</span>
  `;

  let noKlik = 0;
  let yesScale = 1;
  let noScale = 1; // 7-8-d…ô artƒ±q ‚Äú√ßox ki√ßiltmirik‚Äù
  let yesFlowAktiv = false;
  let stage9Aktiv = false;

  function skalaQur(){
    // No h…ômi≈ü…ô g√∂z…ôl qalsƒ±n dey…ô clamp edirik
    const clampedNo = Math.max(0.92, Math.min(1.05, noScale));
    const clampedYes = Math.min(6, Math.max(1, yesScale));
    root.style.setProperty("--yesScale", String(clampedYes));
    root.style.setProperty("--noScale", String(clampedNo));
  }
  skalaQur();

  // ===== Canvas √∂l√ß√ºl…ôri =====
  function canvasOlcu(){
    const dpr = Math.max(1, window.devicePixelRatio || 1);
    const w = window.innerWidth;
    const h = window.innerHeight;

    [stars, broken].forEach(c => {
      c.width = Math.floor(w * dpr);
      c.height = Math.floor(h * dpr);
      c.style.width = w + "px";
      c.style.height = h + "px";
    });
    sctx.setTransform(dpr,0,0,dpr,0,0);
    bctx.setTransform(dpr,0,0,dpr,0,0);

    heartCanvas.width = Math.floor(w * dpr);
    heartCanvas.height = Math.floor(h * dpr);
    heartCanvas.style.width = w + "px";
    heartCanvas.style.height = h + "px";
    hctx.setTransform(dpr,0,0,dpr,0,0);
  }
  window.addEventListener("resize", canvasOlcu, { passive:true });
  canvasOlcu();

  // ===== Liquid Buttons (daha canlƒ±) =====
  class LiquidButton{
    constructor(el, cfg){
      this.el = el;
      this.cfg = cfg;

      this.canvas = document.createElement("canvas");
      this.el.appendChild(this.canvas);
      this.ctx = this.canvas.getContext("2d");

      this.pointsA = [];
      this.pointsB = [];

      this.fakeT = Math.random() * 1000;
      this.relMouseX = 0;
      this.relMouseY = 0;

      this.lastW = 0;
      this.lastH = 0;

      this.init();
      this.render();
    }

    init(){
      const rect = this.el.getBoundingClientRect();
      const w = rect.width;
      const h = rect.height;

      this.lastW = w; this.lastH = h;

      // larger spill => more liquid visible
      this.off = 70;

      this.canvas.width = Math.ceil(w + this.off*2);
      this.canvas.height = Math.ceil(h + this.off*2);
      this.canvas.style.width = (w + this.off*2) + "px";
      this.canvas.style.height = (h + this.off*2) + "px";

      this.pointsA.length = 0;
      this.pointsB.length = 0;

      const points = this.cfg.points;

      const x0 = h/2;
      const addPoint = (x,y) => {
        this.pointsA.push(new Point(this.off + x, this.off + y, 1));
        this.pointsB.push(new Point(this.off + x, this.off + y, 2));
      };

      for(let j=1;j<points;j++){
        addPoint((x0 + ((w-h)/points)*j), 0);
      }
      addPoint(w-h/5, 0);
      addPoint(w+h/10, h/2);
      addPoint(w-h/5, h);
      for(let j=points-1;j>0;j--){
        addPoint((x0 + ((w-h)/points)*j), h);
      }
      addPoint(h/5, h);
      addPoint(-h/10, h/2);
      addPoint(h/5, 0);

      this.relMouseX = this.off + w/2;
      this.relMouseY = this.off + h/2;
    }

    updateFakeMouse(){
      this.fakeT += this.cfg.speed;

      const rect = this.el.getBoundingClientRect();
      const w = rect.width, h = rect.height;

      // bigger amplitude => more visible motion
      const ax = (Math.sin(this.fakeT) * 0.55 + Math.sin(this.fakeT*0.7)*0.22);
      const ay = (Math.cos(this.fakeT*1.1) * 0.50 + Math.sin(this.fakeT*0.9)*0.20);

      this.relMouseX = this.off + (w/2) + ax * (w*0.50);
      this.relMouseY = this.off + (h/2) + ay * (h*0.46);

      // ‚Äúmouse speed‚Äù stronger => more wobble
      this.mouseSpeedX = (Math.sin(this.fakeT*2.4) * 2.8);
      this.mouseSpeedY = (Math.cos(this.fakeT*2.0) * 2.4);
    }

    render(){
      requestAnimationFrame(()=>this.render());

      // if size changed -> re-init immediately (prevents ugly deformation)
      const rect = this.el.getBoundingClientRect();
      if(Math.abs(rect.width - this.lastW) > 0.5 || Math.abs(rect.height - this.lastH) > 0.5){
        this.init();
      }

      this.updateFakeMouse();

      const ctx = this.ctx;
      const cw = this.canvas.width;
      const ch = this.canvas.height;
      ctx.clearRect(0,0,cw,ch);

      // move points
      for(let i=0;i<this.pointsA.length;i++){
        this.pointsA[i].move(this);
        this.pointsB[i].move(this);
      }

      // layer 1
      ctx.beginPath();
      drawBlob(ctx, this.pointsA);
      ctx.closePath();
      ctx.fillStyle = this.cfg.back;
      ctx.fill();

      // dynamic gradient
      const gx = this.relMouseX;
      const gy = this.relMouseY;
      const dist = Math.sqrt(Math.pow(gx - cw/2, 2) + Math.pow(gy - ch/2, 2)) / Math.sqrt(Math.pow(cw/2, 2) + Math.pow(ch/2, 2));
      const grad = ctx.createRadialGradient(gx, gy, 240 + 240*dist, gx, gy, 0);
      grad.addColorStop(0, this.cfg.gradA);
      grad.addColorStop(1, this.cfg.gradB);

      // layer 2
      ctx.beginPath();
      drawBlob(ctx, this.pointsB);
      ctx.closePath();
      ctx.fillStyle = grad;
      ctx.fill();
    }
  }

  function Point(x,y,level){
    this.x = this.ix = x;
    this.y = this.iy = y;
    this.vx = 0;
    this.vy = 0;
    this.level = level;
  }

  Point.prototype.move = function(host){
    const viscosity = host.cfg.viscosity;
    const damping = host.cfg.damping;
    const mouseDist = host.cfg.mouseDist;

    // spring back
    this.vx += (this.ix - this.x) / (viscosity * this.level);
    this.vy += (this.iy - this.y) / (viscosity * this.level);

    // fake mouse impact
    const dx = this.ix - host.relMouseX;
    const dy = this.iy - host.relMouseY;
    const relDist = (1 - Math.sqrt((dx*dx) + (dy*dy)) / mouseDist);

    if(relDist > 0 && relDist < 1){
      this.vx += (host.mouseSpeedX / 3.2) * relDist;
      this.vy += (host.mouseSpeedY / 3.2) * relDist;
    }

    this.vx *= (1 - damping);
    this.vy *= (1 - damping);
    this.x += this.vx;
    this.y += this.vy;
  };

  function drawBlob(ctx, pts){
    ctx.moveTo(pts[0].x, pts[0].y);
    for(let i=0;i<pts.length;i++){
      const p = pts[i];
      const np = pts[i+1] || pts[0];
      const cx = (p.x + np.x)/2;
      const cy = (p.y + np.y)/2;
      ctx.quadraticCurveTo(p.x, p.y, cx, cy);
    }
  }

  // Instances (more movement)
  new LiquidButton(yesBtn, {
    points: 9,
    viscosity: 14,   // ‚Üì => more elastic
    mouseDist: 120,  // ‚Üë => wider influence
    damping: 0.035,  // ‚Üì => more wobble
    speed: 0.026,    // ‚Üë => more alive
    back:  "#1CE2D8",
    gradA: "#22c55e",
    gradB: "#7c3aed"
  });

  new LiquidButton(noBtn, {
    points: 9,
    viscosity: 14,
    mouseDist: 120,
    damping: 0.035,
    speed: 0.026,
    back:  "#ff9aa2",
    gradA: "#ff2d55",
    gradB: "#ef4444"
  });

  // ===== NO teleport (Tak √ºst…ô d√º≈üm…ôsin) =====
  function noAbsoluteEt(){
    if(!noBtn.classList.contains("no-abs")){
      noBtn.classList.add("no-abs");
      root.appendChild(noBtn);
    }
  }
  function noAnimTemizle(){
    noBtn.classList.remove("shake3s");
    noBtn.classList.remove("break5s");
  }

  function qadaƒüaZonaVar(x, y){
    const r = yesBtn.getBoundingClientRect();
    const cx = r.left + r.width/2;
    const cy = r.top + r.height/2;
    const dx = Math.abs(x - cx);
    const dy = Math.abs(y - cy);
    return (dx < (r.width*0.85) && dy < (r.height*0.75));
  }

  function noYerQur(px, py){
    noAbsoluteEt();
    noBtn.style.left = px + "px";
    noBtn.style.top  = py + "px";
  }

  function randomNoYer(){
    const pad = 24;
    const r = noBtn.getBoundingClientRect();
    const bw = r.width || 260;
    const bh = r.height || 90;

    const maxX = window.innerWidth - bw - pad;
    const maxY = window.innerHeight - bh - pad;

    let x, y, guard=0;
    do{
      x = pad + Math.random() * Math.max(1, maxX - pad);
      y = pad + Math.random() * Math.max(1, maxY - pad);
      guard++;
      if(guard > 70) break;
    } while(qadaƒüaZonaVar(x + bw/2, y + bh/2));

    noYerQur(x, y);
  }

  // ===== Stars / Broken / Heart minimal (same as before) =====
  let starsArr=[], starsRAF=null;
  function starsHazirla(){
    starsArr=[];
    const w=innerWidth,h=innerHeight;
    const say=Math.max(80, Math.floor((w*h)/22000));
    for(let i=0;i<say;i++){
      starsArr.push({x:Math.random()*w,y:Math.random()*h,sp:2+Math.random()*5,sz:1+Math.random()*2.4,a:.45+Math.random()*.55});
    }
  }
  function starsCek(){
    const w=innerWidth,h=innerHeight;
    sctx.clearRect(0,0,w,h);
    for(const p of starsArr){
      p.y += p.sp;
      if(p.y>h+10){p.y=-10;p.x=Math.random()*w;}
      sctx.globalAlpha=p.a;
      sctx.fillStyle="#fff";
      sctx.beginPath(); sctx.arc(p.x,p.y,p.sz,0,Math.PI*2); sctx.fill();
    }
    starsRAF=requestAnimationFrame(starsCek);
  }
  function starsStart(){ stars.classList.add("show"); starsHazirla(); if(starsRAF) cancelAnimationFrame(starsRAF); starsRAF=requestAnimationFrame(starsCek); }
  function starsStop(){ stars.classList.remove("show"); if(starsRAF) cancelAnimationFrame(starsRAF); starsRAF=null; sctx.clearRect(0,0,innerWidth,innerHeight); }

  let brokenArr=[], brokenRAF=null;
  function brokenHazirla(){
    brokenArr=[];
    const w=innerWidth,h=innerHeight;
    const say=Math.max(90, Math.floor((w*h)/16000));
    for(let i=0;i<say;i++){
      brokenArr.push({x:Math.random()*w,y:Math.random()*h,sp:3+Math.random()*6.8,sz:18+Math.random()*20,rot:Math.random()*Math.PI*2,vr:(-0.03+Math.random()*0.06),a:.65+Math.random()*.35});
    }
  }
  function brokenCek(){
    const w=innerWidth,h=innerHeight;
    bctx.clearRect(0,0,w,h);
    for(const p of brokenArr){
      p.y+=p.sp; p.rot+=p.vr;
      if(p.y>h+40){p.y=-40;p.x=Math.random()*w;}
      bctx.save();
      bctx.translate(p.x,p.y); bctx.rotate(p.rot);
      bctx.globalAlpha=p.a;
      bctx.font=`${p.sz}px system-ui, Apple Color Emoji, Segoe UI Emoji, Noto Color Emoji`;
      bctx.textAlign="center"; bctx.textBaseline="middle";
      bctx.fillText("üíî",0,0);
      bctx.restore();
    }
    brokenRAF=requestAnimationFrame(brokenCek);
  }
  function brokenStart(){ broken.classList.add("show"); brokenHazirla(); if(brokenRAF) cancelAnimationFrame(brokenRAF); brokenRAF=requestAnimationFrame(brokenCek); }
  function brokenStop(){ broken.classList.remove("show"); if(brokenRAF) cancelAnimationFrame(brokenRAF); brokenRAF=null; bctx.clearRect(0,0,innerWidth,innerHeight); }

  // Liquid heart (same symmetric wave heart)
  let heartRAF=null, heartT=0;
  function heartStart(){
    heartScene.classList.add("show");
    heartT=0;
    if(heartRAF) cancelAnimationFrame(heartRAF);
    heartRAF=requestAnimationFrame(heartDraw);
  }
  function heartStop(){
    heartScene.classList.remove("show");
    if(heartRAF) cancelAnimationFrame(heartRAF);
    heartRAF=null;
    hctx.clearRect(0,0,innerWidth,innerHeight);
  }
  function heartDraw(){
    const w=innerWidth,h=innerHeight;
    hctx.clearRect(0,0,w,h);
    heartT += 0.018;

    const cx=w/2, cy=h/2;
    const beat = 1 + Math.sin(heartT*2.2)*0.06;
    const baseSize = Math.min(w,h)*0.18;

    const pts=[], N=220;
    for(let i=0;i<=N;i++){
      const t=(i/N)*Math.PI*2;
      const x=16*Math.pow(Math.sin(t),3);
      const y=13*Math.cos(t)-5*Math.cos(2*t)-2*Math.cos(3*t)-Math.cos(4*t);

      const wave = 1 + Math.sin(t*6 + heartT*3.0)*0.045 + Math.cos(t*3 - heartT*2.0)*0.03;
      const px = cx + (x * baseSize * 0.065) * beat * wave;
      const py = cy - (y * baseSize * 0.065) * beat * wave;
      pts.push({x:px,y:py});
    }

    const g = hctx.createRadialGradient(cx - baseSize*0.2, cy - baseSize*0.2, baseSize*0.2, cx, cy, baseSize*1.4);
    g.addColorStop(0,"rgba(255,110,150,1)");
    g.addColorStop(0.55,"rgba(255,45,85,1)");
    g.addColorStop(1,"rgba(160,10,60,1)");

    hctx.beginPath();
    hctx.moveTo(pts[0].x, pts[0].y);
    for(let i=1;i<pts.length-2;i++){
      const cpx=(pts[i].x+pts[i+1].x)/2;
      const cpy=(pts[i].y+pts[i+1].y)/2;
      hctx.quadraticCurveTo(pts[i].x, pts[i].y, cpx, cpy);
    }
    hctx.closePath();
    hctx.fillStyle=g; hctx.fill();

    hctx.globalAlpha=.22;
    hctx.lineWidth=Math.max(1.5, baseSize*0.02);
    hctx.strokeStyle="rgba(255,255,255,0.65)";
    hctx.stroke();
    hctx.globalAlpha=1;

    heartRAF=requestAnimationFrame(heartDraw);
  }

  function resetBaslangic(){
    yesFlowAktiv=false;
    stage9Aktiv=false;

    root.classList.remove("stage9");
    dark.classList.remove("show");

    starsStop();
    brokenStop();
    heartStop();

    msg.classList.remove("show");
    msg.innerHTML="";

    row.classList.remove("fade-out");
    yesBtn.disabled=false;
    noBtn.disabled=false;

    noKlik=0;
    yesScale=1;
    noScale=1;
    skalaQur();

    if(noBtn.classList.contains("no-abs")){
      noAnimTemizle();
      noBtn.classList.remove("no-abs");
      noBtn.style.left="";
      noBtn.style.top="";
      row.appendChild(noBtn);
    }
  }

  function stage9Basla(){
    stage9Aktiv=true;

    starsStop();
    heartStop();
    msg.classList.remove("show");
    msg.innerHTML="";
    dark.classList.remove("show");

    root.classList.add("stage9");
    noBtn.disabled=true;
    brokenStart();
  }

  function yesFlowBasla(){
    if(yesFlowAktiv) return;
    yesFlowAktiv=true;

    if(stage9Aktiv){
      brokenStop();
      stage9Aktiv=false;
      root.classList.remove("stage9");
    }

    row.classList.add("fade-out");
    yesBtn.disabled=true;
    noBtn.disabled=true;

    dark.classList.add("show");
    starsStart();

    msg.innerHTML = MESAJ_HTML;
    msg.classList.add("show");

    setTimeout(()=>{
      msg.classList.remove("show");
      msg.innerHTML="";
      starsStop();
      heartStart();
    }, 5000);

    setTimeout(()=> resetBaslangic(), 15000);
  }

  // ==== Clicks ====
  yesBtn.addEventListener("click", ()=>{
    if(stage9Aktiv){
      brokenStop();
      stage9Aktiv=false;
      root.classList.remove("stage9");
    }
    yesFlowBasla();
  });

  noBtn.addEventListener("click", ()=>{
    if(yesFlowAktiv) return;
    noKlik++;

    if(![3,4,6,9].includes(noKlik)) randomNoYer();
    else noAbsoluteEt();

    if(noKlik===1){
      noAnimTemizle();
      noBtn.classList.add("shake3s");
      setTimeout(()=>noBtn.classList.remove("shake3s"), 3000);
      return;
    }
    if(noKlik===2){
      noAnimTemizle();
      noBtn.classList.add("break5s");
      setTimeout(()=>noBtn.classList.remove("break5s"), 5000);
      return;
    }
    if(noKlik===3){ noYerQur(26,26); return; }
    if(noKlik===4){
      const r=noBtn.getBoundingClientRect();
      noYerQur(innerWidth - r.width - 26, innerHeight - r.height - 26);
      return;
    }
    if(noKlik===6){
      const r=noBtn.getBoundingClientRect();
      noYerQur((innerWidth - r.width)/2, 22);
      return;
    }

    // 7 v…ô 8: dizayn korlanmasƒ±n dey…ô No-nu ki√ßiltmirik.
    // Sad…ôc…ô Yes b√∂y√ºs√ºn (2x), No eyni g√∂z…ôl qalsƒ±n.
    if(noKlik===7){
      yesScale *= 2;
      noScale = 1; // always reset to normal => ‚Äúiyr…ônc‚Äù olmur
      skalaQur();
      randomNoYer();
      return;
    }
    if(noKlik===8){
      yesScale *= 2;
      noScale = 1;
      skalaQur();
      randomNoYer();
      return;
    }

    if(noKlik===9){
      stage9Basla();
      return;
    }
  });

})();
</script>
{% endblock %}
